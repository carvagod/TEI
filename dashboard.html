<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Usuario</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f9;
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        header {
            background: #6200ea;
            color: #fff;
            padding: 1rem;
        }
        h1 {
            color: #6200ea;
        }
        footer {
            background: #333;
            color: #fff;
            padding: 1rem;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>
<body>
    <header>
        <h1>Bienvenido, <span id="userName"></span>!</h1>
    </header>
    <p>Aquí puedes gestionar tus horarios y tareas pendientes.</p>
    <footer>
        <p>&copy; 2024 Gestión de Horarios. Todos los derechos reservados.</p>
    </footer>
    <script>
    const params = new URLSearchParams(window.location.search);
    const userName = params.get("name");
    const userId = params.get("userId");
    const horariosCsvUrl = "https://raw.githubusercontent.com/carvagod/TEI/refs/heads/main/horarios.csv"; // Enlace RAW del CSV de horarios

    if (userName) {
        document.getElementById("userName").textContent = decodeURIComponent(userName);

        // Función para mapear días de la semana a columnas
        const diasSemana = ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado"];
        const bloquesDia = 12;

        // Crear tabla de horarios disponibles
        function crearTablaHorarios() {
            const table = document.createElement("table");
            table.style.margin = "20px auto";
            table.style.borderCollapse = "collapse";
            table.style.width = "80%";
            table.style.textAlign = "center";

            // Crear encabezados (días de la semana)
            const headerRow = document.createElement("tr");
            const emptyCell = document.createElement("th");
            emptyCell.textContent = "Bloque";
            headerRow.appendChild(emptyCell);

            diasSemana.forEach(dia => {
                const th = document.createElement("th");
                th.textContent = dia;
                th.style.border = "1px solid #ccc";
                th.style.padding = "8px";
                th.style.backgroundColor = "#6200ea";
                th.style.color = "#fff";
                headerRow.appendChild(th);
            });

            table.appendChild(headerRow);

            // Crear filas de bloques (1-12)
            for (let i = 1; i <= bloquesDia; i++) {
                const row = document.createElement("tr");

                // Primera celda: número del bloque
                const blockCell = document.createElement("td");
                blockCell.textContent = i;
                blockCell.style.border = "1px solid #ccc";
                blockCell.style.padding = "8px";
                blockCell.style.backgroundColor = "#f4f4f9";
                row.appendChild(blockCell);

                // Celdas para cada día
                for (let j = 0; j < diasSemana.length; j++) {
                    const cell = document.createElement("td");
                    cell.style.border = "1px solid #ccc";
                    cell.style.padding = "8px";
                    cell.style.minHeight = "50px";
                    row.appendChild(cell);
                }

                table.appendChild(row);
            }

            return table;
        }

        // Completar la tabla con datos del CSV
        function llenarTablaHorarios(table, horarios) {
            const rows = table.querySelectorAll("tr");

            horarios.forEach(horario => {
                const [id, ramo, seccion, ...bloques] = horario.split(",");

                // Verificar si el ID coincide con el usuario
                if (id !== userId) return;

                bloques.forEach(bloque => {
                    if (!bloque.trim()) return; // Ignorar bloques vacíos

                    // Extraer día y bloque del formato (e.g., "Lunes 1-2")
                    const [dia, rango] = bloque.split(" ");
                    if (!dia || !rango) return;

                    const diaIndex = diasSemana.indexOf(dia);
                    if (diaIndex === -1) return;

                    const [inicio, fin] = rango.split("-").map(Number);

                    // Completar las celdas correspondientes
                    for (let i = inicio; i <= fin; i++) {
                        const cell = rows[i].children[diaIndex + 1]; // +1 porque la primera columna es el número de bloque
                        const contenido = `${ramo} (Sección ${seccion})`;

                        if (cell.textContent.trim()) {
                            // Si ya hay contenido, añadirlo separado por un punto aparte
                            cell.textContent += ` // ${contenido}`;
                        } else {
                            cell.textContent = contenido;
                        }
                    }
                });
            });
        }

        // Cargar datos del CSV y generar la tabla
        fetch(horariosCsvUrl)
            .then(response => {
                if (!response.ok) throw new Error("Error al cargar los datos del CSV.");
                return response.text();
            })
            .then(data => {
                const horarios = data.split("\n").slice(1).filter(row => row); // Omitir encabezados y filas vacías

                const table = crearTablaHorarios();
                llenarTablaHorarios(table, horarios);
                document.body.appendChild(table);
            })
            .catch(error => {
                console.error(error);
                document.body.innerHTML += "<p>Error al cargar los horarios. Intenta más tarde.</p>";
            });
    } else {
        document.body.innerHTML = "<h1>Acceso denegado. Inicia sesión primero.</h1>";
    }
    </script>


    
      
</body>
</html>
